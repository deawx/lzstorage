!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):t.LZStorage=o()}(this,function(){"use strict";function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t){return function(t){if(Array.isArray(t)){for(var o=0,e=new Array(t.length);o<t.length;o++)e[o]=t[o];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h=String.fromCharCode;function l(t,o){return Object.prototype.hasOwnProperty.call(t,o)}function c(t,o,e){if(l(t.context_dictionaryToCreate,t.context_w)){if(t.context_w.charCodeAt(0)<256){for(var n=0;n<t.context_numBits;n++)t.context_data_val=t.context_data_val<<1,t.context_data_position==o-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++;t.value=t.context_w.charCodeAt(0);for(var a=0;a<8;a++)t.context_data_val=t.context_data_val<<1|1&t.value,t.context_data_position==o-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++,t.value=t.value>>1}else{t.value=1;for(var i=0;i<t.context_numBits;i++)t.context_data_val=t.context_data_val<<1|t.value,t.context_data_position==o-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++,t.value=0;t.value=t.context_w.charCodeAt(0);for(var r=0;r<16;r++)t.context_data_val=t.context_data_val<<1|1&t.value,t.context_data_position==o-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++,t.value=t.value>>1}t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++),delete t.context_dictionaryToCreate[t.context_w]}else{t.value=t.context_dictionary[t.context_w];for(var c=0;c<t.context_numBits;c++)t.context_data_val=t.context_data_val<<1|1&t.value,t.context_data_position==o-1?(t.context_data_position=0,t.context_data.push(e(t.context_data_val)),t.context_data_val=0):t.context_data_position++,t.value=t.value>>1}t.context_enlargeIn--,0==t.context_enlargeIn&&(t.context_enlargeIn=Math.pow(2,t.context_numBits),t.context_numBits++)}function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o=1<arguments.length?arguments[1]:void 0,e=2<arguments.length?arguments[2]:void 0;if(null===t)return"";for(var n={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0},a=0,i=0;i<t.length;i+=1)n.context_c=t.charAt(i),l(n.context_dictionary,n.context_c)||(n.context_dictionary[n.context_c]=n.context_dictSize++,n.context_dictionaryToCreate[n.context_c]=!0),n.context_wc=n.context_w+n.context_c,l(n.context_dictionary,n.context_wc)?n.context_w=n.context_wc:(c(n,o,e),n.context_dictionary[n.context_wc]=n.context_dictSize++,n.context_w=String(n.context_c));for(""!==n.context_w&&c(n,o,e),n.value=2,a=0;a<n.context_numBits;a++)n.context_data_val=n.context_data_val<<1|1&n.value,n.context_data_position==o-1?(n.context_data_position=0,n.context_data.push(e(n.context_data_val)),n.context_data_val=0):n.context_data_position++,n.value=n.value>>1;for(;;){if(n.context_data_val=n.context_data_val<<1,n.context_data_position==o-1){n.context_data.push(e(n.context_data_val));break}n.context_data_position++}return n.context_data.join("")}function x(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return null===t?"":e(t,15,function(t){return h(t+32)})+" "}function s(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return null===e?"":""===e?null:function(t,o,e){for(var n,a,i,r=[],c={val:e(0),position:o,index:1},l=[],s=4,u=4,p=3,f="",v=0;v<3;v+=1)r[v]=v;for(var _=0,d=Math.pow(2,2),x=1;x!==d;)a=c.val&c.position,c.position>>=1,0===c.position&&(c.position=o,c.val=e(c.index++)),_|=(0<a?1:0)*x,x<<=1;switch(_){case 0:for(_=0,d=Math.pow(2,8),x=1;x!==d;)a=c.val&c.position,c.position>>=1,0===c.position&&(c.position=o,c.val=e(c.index++)),_|=(0<a?1:0)*x,x<<=1;i=h(_);break;case 1:for(_=0,d=Math.pow(2,16),x=1;x!==d;)a=c.val&c.position,c.position>>=1,0===c.position&&(c.position=o,c.val=e(c.index++)),_|=(0<a?1:0)*x,x<<=1;i=h(_);break;case 2:return""}for(n=r[3]=i,l.push(i);;){if(c.index>t)return"";for(_=0,d=Math.pow(2,p),x=1;x!==d;)a=c.val&c.position,c.position>>=1,0===c.position&&(c.position=o,c.val=e(c.index++)),_|=(0<a?1:0)*x,x<<=1;switch(i=_){case 0:for(_=0,d=Math.pow(2,8),x=1;x!==d;)a=c.val&c.position,c.position>>=1,0===c.position&&(c.position=o,c.val=e(c.index++)),_|=(0<a?1:0)*x,x<<=1;r[u++]=h(_),i=u-1,s--;break;case 1:for(_=0,d=Math.pow(2,16),x=1;x!==d;)a=c.val&c.position,c.position>>=1,0===c.position&&(c.position=o,c.val=e(c.index++)),_|=(0<a?1:0)*x,x<<=1;r[u++]=h(_),i=u-1,s--;break;case 2:return l.join("")}if(0===s&&(s=Math.pow(2,p),p++),r[i])f=r[i];else{if(i!==u)return null;f=n+n.charAt(0)}l.push(f),r[u++]=n+f.charAt(0),n=f,0==--s&&(s=Math.pow(2,p),p++)}}(o.length,16384,function(t){return o.charCodeAt(t)-32})}var g={params:"Insufficient parameters"},u=Object.prototype.hasOwnProperty;function p(){var t;"undefined"!=typeof console&&(t=console).log.apply(t,arguments)}function f(){var t;"undefined"!=typeof console&&(t=console).error.apply(t,arguments)}function v(t){return!Array.isArray(t)&&null!==t&&"object"===d(t)}function i(){if(1<arguments.length){var t=Array.prototype.slice.call(arguments),o=t[0],e=t[1],n=void 0===e?"":e,a=t[2],i=t[3],r=void 0===i?"/":i,c=t[4],l=void 0===c?window.location.hostname:c,s=n;null!==n&&"object"===d(n)&&(s=JSON.stringify(n));var u=new Date;"number"==typeof a&&(a===1/0?u=new Date("Thu, 31 Dec 2037 00:00:00 GMT"):u.setTime(u.getTime()+24*a*60*60*1e3));var p=a?"; expires=".concat(u.toUTCString()):"",f="; path=".concat(r.trim()),v="";-1===["localhost","127.0.0.1",null].indexOf(l)&&(v="; domain=".concat(l.trim()));var _="";"https:"===window.location.protocol&&(_="; secure"),document.cookie="".concat(o,"=").concat(this.config.compression?x(s):s).concat(p).concat(v).concat(f).concat(_)}else this.config.debug&&console.log(g.params)}function _(){var e=this;if(0<arguments.length){var n=Array.prototype.slice.call(arguments)[0],t=null;if((t=decodeURIComponent(document.cookie).split(";")).length){var a="";return t.forEach(function(t){var o=t.indexOf("".concat(n,"="));-1<o&&(a=e.config.compression?s(t.substring(o+"".concat(n,"=").length,t.length)).trim():t.substring(o+"".concat(n,"=").length,t.length).trim())}),a}}return""}function y(){if(0<arguments.length){var t,o=Array.prototype.slice.call(arguments),e=o[0],n=o[1],a=void 0===n?"/":n,i=o[2],r=void 0===i?window.location.hostname:i,c="";return-1===["localhost","127.0.0.1",null].indexOf(r)&&(c="; domain=".concat(r.trim())),t="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC").concat(c,"; path=").concat(a),document.cookie=t,!_.apply(this,[e]).length}return!1}return function(){function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}(this,o),this.config=t}var t,e,n;return t=o,(e=[{key:"available",value:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return this.config.debug&&p("Storage API is not supported in this environment"),!1}}},{key:"set",value:function(){if(1<arguments.length){var t=Array.prototype.slice.call(arguments),o=t[0],e=t[1],n=t[2],a=void 0!==n&&n,i=e;if(null!==e&&"object"===d(e)&&(i=JSON.stringify(e)),this.available())try{window[a?"sessionStorage":"localStorage"].setItem(o,this.config.compression?x(i):i)}catch(t){this.config.debug&&f(t)}else this.setCookie(o,i,a?1/0:void 0)}else this.config.debug&&p(g.params)}},{key:"remove",value:function(){if(0<arguments.length){var t=Array.prototype.slice.call(arguments)[0];if(this.available())try{return window.localStorage.removeItem(t),window.sessionStorage.removeItem(t),!window.localStorage.key(t)||!window.sessionStorage.key(t)||this.removeCookie(t)}catch(t){this.config.debug&&f(t)}return this.removeCookie(t)}this.config.debug&&p(g.params)}},{key:"getAll",value:function(){var o=this;if(0<arguments.length){var t=Array.prototype.slice.call(arguments),e=t[0],n=t[1],a=void 0!==n&&n,i=[];if(this.available())try{var r=["sessionStorage"];a||r.push("localStorage"),r.forEach(function(t){u.call(window[t],e)&&i.push({value:o.config.compression?s(window[t].getItem(e)):window[t].getItem(e),storage:t})})}catch(t){this.config.debug&&f(t)}var c=this.getCookie(e);return c&&i.push({value:c,storage:"cookie"}),i.map(function(t){try{t.value=JSON.parse(t.value)}catch(t){o.config.debug&&p(t)}return t})}return[]}},{key:"get",value:function(){if(0<arguments.length){var t=Array.prototype.slice.call(arguments),o=t[0],e=t[1],n=void 0!==e&&e,a=this.getAll(o,n);if(0===a.length)return;if(1===a.length)return a[0].value;if(3===a.length)return a.filter(function(t){return t.storage===(n?"sessionStorage":"localStorage")})[0].value;var i=a.map(function(t){return t.storage});return n?-1<i.indexOf("sessionStorage")?a.filter(function(t){return"sessionStorage"===t.storage})[0].value:a.filter(function(t){return"cookie"===t.storage})[0].value:a.filter(function(t){return-1<["sessionStorage","localStorage"].indexOf(t.storage)})[0].value}this.config.debug&&p(g.params)}},{key:"update",value:function(){var n=this;if(2===arguments.length){var t=Array.prototype.slice.call(arguments),a=t[0],o=t[1],e=this.getAll(a),i=null;if("function"==typeof o)i=o.apply(void 0,r(e));else if(void 0!==d(o))try{i=JSON.parse(o)}catch(t){this.config.debug&&f(t),i=o}void 0!==i&&e.forEach(function(t){var o=t.value;v(o)&&v(i)?t.value=function(a){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),o.forEach(function(t){var o,e,n;o=a,n=i[e=t],e in o?Object.defineProperty(o,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[e]=n})}return a}({},o,i):t.value=i}),e.forEach(function(t){var o=t.value,e=t.storage;-1<["sessionStorage","localStorage"].indexOf(e)&&n.set(a,o,"sessionStorage"===e),"cookie"===e&&n.setCookie(a,o)})}else this.config.debug&&p(g.params)}},{key:"setCookie",value:function(){return i.apply(this,arguments)}},{key:"getCookie",value:function(){return _.apply(this,arguments)}},{key:"removeCookie",value:function(){return y.apply(this,arguments)}},{key:"resetCookie",value:function(){return function(t,o,e,n,a){y.apply(this,[t,n,a]),i.apply(this,[t,o,e,n,a])}.apply(this,arguments)}}])&&a(t.prototype,e),n&&a(t,n),o}()});
